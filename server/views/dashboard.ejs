<%- include ./partials/header.ejs %>
<body>
  <div class="login-form">
      <div class="image">
        <img src="/images/icon.png" alt="" class="logo"/>
      </div>
      <div class="row">
        <div class="center-align">
          <button onclick="startConverting()" class="btn-floating btn-large waves-effect waves-light red"><i class="fa fa-microphone"></i></button>
        </div>
       <form class="col s12" action="/result" method="post">
         <div class="row">
           <div class="input-field col s12">
             <textarea  id="result" class="materialize-textarea" placeholder="Please speak" name="speech"></textarea>
             <!-- <label for="result">Textarea</label> -->
           </div>
         </div>
         <button type="submit" name="button" class="waves-effect waves-light btn">translate</button>
       </form>
     </div>
      <!-- <button type="submit" class="log-btn" >Submit</button> -->
      <br><br>
      <a class="link" href="/register">Not registerd yet? Sign Up here</a> <br><br>
      <% if(error !== null) {%>
        <p class="text-center alert-danger-cstm"><%= error %></p>
      <% } %>
  </div>
  <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
  <!-- <script src="/javascripts/speech-to-text"> </script> -->
  <script type="text/javascript">
      var r = document.getElementById('result')
      function startConverting(){
        if ('webkitSpeechRecognition' in window) {
          var speechRecognizer = new webkitSpeechRecognition()
          speechRecognizer.continous = true
          speechRecognizer.interimResults = true
          speechRecognizer.lang = 'id-ID'
          speechRecognizer.start();
          var finalTranscripts = ''
          speechRecognizer.onresult = function(event){
            var interimTranscripts = ''
            for (var i = event.resultIndex; i < event.results.length; i++) {
              var transcript = event.results[i][0].transcript
              transcript.replace("\n", "<br>")
              if (event.results[i].isFinal) {
                finalTranscripts += transcript
              } else {
                interimTranscripts += transcript
              }
            }
            r.innerHTML = finalTranscripts + interimTranscripts
          }
          speechRecognizer.onerror = function(event) {
          }
        } else {
          r.innerHTML = "Your browser is not supported. If google chrome, please upgrade"
        }
      }
  </script>
</body>
</html>
